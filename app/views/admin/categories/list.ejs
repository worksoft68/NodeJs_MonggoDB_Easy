<%- include ('./../helpers/pagination') %>
	<% const collection="categories" ; const linkPrefix=systemConfig.prefixAdmin + `/${collection}/`; %>
		<%- include ('./../elements/notify') %>
			<div class="container-fluid">
				<input name="linkPrefix" id="linkPrefix" type="hidden" value="<%= linkPrefix %>">
				<input name="params" id="params" type="hidden" value="<%= params %>">
				&nbsp; &nbsp; <button type="button" id="btnOpenMainModalForm" class="btn btn-primary">
					<i class="fas fa-plus"></i> Add new
				</button>
				&nbsp; <button type="button" id="btnDelete" class="btn-sm btn-danger" title="Delete">
					<i class="fas fa-trash-alt"></i> Delete
				</button>
				&nbsp; <button type="button" id="btnSearchPost_OpenForm" class="btn-sm btn-info" title="Search">
					<i class="fa fa-search"></i> Search
				</button>
				&nbsp; <button type="button" id="btnExport_OpenForm" class="btn-sm btn-success" title="Export">
					<i class="fa fa-download"></i> Export
				</button>
				&nbsp; <button type="button" id="btnRefreshPage" class="btn-sm btn-warning" title="Refresh"
					onclick="RefreshPage()">
					<i class="fa fa-refresh"></i> Refresh
				</button>
				<!-- ================ Modal From ======================== -->
				<div class="modal fade" id="modaMainForm" data-backdrop="static" data-keyboard="true" tabindex="- 1"
					role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
					<div class="modal-dialog modal-xl" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="exampleModalLabel">Add New & Edit</h5>
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<div class="modal-body">
								<form role="form" name="formcategories" id="formcategories" autocomplete="off"
									enctype="multipart/form-data" action=" <%= linkPrefix %>save" method="post">
									<div class="form-group row">
										<label id="labparent_id"
											class="col-sm-2 col-form-label text-sm-right ">Parent</label>
										<div class="col-xs-2 col-sm-2">
											<div class="dropdown">
												<div id="divDropdownparentName" class="dropdown-content">
													<input type="text" id="parentName" name="parentName"
														onkeyup="filterSelectBox('parentName')"
														onfocus="focusDropdown('parentName')"
														onblur="blurDropdown('parentName')"
														class="form-control form-control-sm">
													<input id="parent_id" name="parent_id" type="hidden">
													<div id="DivContenparentName" class="Divdropdown-content">
													</div>
												</div>
											</div>
										</div>
										<label id="labname"
											class="col-sm-2 col-form-label text-sm-right required">Name</label>
										<div class="col-xs-2 col-sm-2">
											<input type="text" name="name" id="name" value="<%= item.name %>"
												class="form-control form-control-sm">
										</div>
										<label id="labslug"
											class="col-sm-2 col-form-label text-sm-right required">Slug</label>
										<div class="col-xs-2 col-sm-2">
											<input type="text" name="slug" id="slug" value="<%= item.slug %>"
												class="form-control form-control-sm">
										</div>
										<label id="labthumbnail"
											class="col-sm-2 col-form-label text-sm-right ">Image</label>
										<div class="col-xs-2 col-sm-2">
											<input type="file" name="thumbnail" id="thumbnail"
												class="form-control form-control-sm">
											<input type="hidden" name="thumbnail_old" id="thumbnail_old"
												value="<%= item.thumbnail %>">
										</div>
										<label id="labviewtype"
											class="col-sm-2 col-form-label text-sm-right required">View Type</label>
										<div class="col-xs-2 col-sm-2">
											<select id="viewtype" name="viewtype"
												class="custom-select custom-select-sm">
												<option value="novalue">Choose View Type</option>
												<option value="view-list" <%=(item.ViewType=="view-list" )
													? 'selected="selected"' : '' %> >View list</option>
												<option value="view-thumb" <%=(item.ViewType=="view-thumb" )
													? 'selected="selected"' : '' %> >View thumb</option>
												<option value="view-link" <%=(item.ViewType=="view-link" )
													? 'selected="selected"' : '' %> >View a link</option>
												</select>
										</div>
										<label id="labzone" class="col-sm-2 col-form-label text-sm-right ">Zone</label>
										<div class="col-xs-2 col-sm-2">
											<select id="zone" name="zone" class="custom-select custom-select-sm">
												<option value="novalue">Choose a zone</option>
												<option value="Top" <%=(item.zone=="Top" ) ? 'selected="selected"' : ''
													%> >Top</option>
												<option value="Left" <%=(item.zone=="Left" ) ? 'selected="selected"'
													: '' %> >Left</option>
												<option value="Right" <%=(item.zone=="Right" ) ? 'selected="selected"'
													: '' %> >Right</option>
												<option value="Bottom" <%=(item.zone=="Bottom" ) ? 'selected="selected"'
													: '' %> >Bottom</option>

												<option value="Zone 1" <%=(item.zone=="Zone 1" ) ? 'selected="selected"'
													: '' %> >Zone 1</option>
												<option value="Zone 2" <%=(item.zone=="Zone 2" ) ? 'selected="selected"'
													: '' %> >Zone 2</option>
												<option value="Zone 3" <%=(item.zone=="Zone 3" ) ? 'selected="selected"'
													: '' %> >Zone 3</option>
												<option value="Zone 4" <%=(item.zone=="Zone 4" ) ? 'selected="selected"'
													: '' %> >Zone 4</option>
												<option value="Zone 5" <%=(item.zone=="Zone 5" ) ? 'selected="selected"'
													: '' %> >Zone 5</option>
												<option value="Zone 6" <%=(item.zone=="Zone 6" ) ? 'selected="selected"'
													: '' %> >Zone 6</option>
											</select>
										</div>
										<label id="labis_show_homepage"
											class="col-sm-2 col-form-label text-sm-right required">Show Homepage</label>
										<div class="col-xs-2 col-sm-2">
											<input type="checkbox" name="is_show_homepage" id="is_show_homepage"
												class="form-control form-control-sm form-control-checkbox">
										</div>
										<label id="labordering"
											class="col-sm-2 col-form-label text-sm-right ">Ordering</label>
										<div class="col-xs-2 col-sm-2">
											<input type="number" name="ordering" id="ordering"
												value="<%= item.ordering %>" class="form-control form-control-sm">
										</div>
										<label id="labdescription"
											class="col-sm-2 col-form-label text-sm-right ">Description</label>
										<div class="col-xs-2 col-sm-2">
											<input type="text" name="description" id="description"
												value="<%= item.description %>" class="form-control form-control-sm">
										</div>
										<label id="labstatus"
											class="col-sm-2 col-form-label text-sm-right required">Status</label>
										<div class="col-xs-2 col-sm-2">
											<select id="status" name="status" class="custom-select custom-select-sm">
												<option value="novalue">Choose Status</option>
												<option value="Active" <%=(item.status=="Active" )
													? 'selected="selected"' : '' %> >Active</option>
												<option value="Inactive" <%=(item.status=="Inactive" )
													? 'selected="selected"' : '' %> >Inactive</option>
											</select>
										</div>
										<label id="lablink" class="col-sm-2 col-form-label text-sm-right">Link</label>
										<div class="col-xs-6 col-sm-6" id="divlink">
											<input type="text" name="link" id="link" value="<%= item.link %>"
											class="form-control form-control-sm">
										</div>
									</div>
									<div class="form-group row">
										<div class="text-success" id="divMessage"></div>
									</div>
									<input name="_idHidden" id="_idHidden" type="hidden">
									<div class="modal-footer">
										&nbsp; <button type="button" id="btnCloseMainMoal" data-dismiss="modal"
											class="btn btn-sm btn-primary" title="Close">
											<i class="fa fa-mail-reply"></i> Close
										</button>
										<button type="button" id="btnSave" class="btn-sm btn-success" title="Save">
											<i class="fa fa-save"></i> Save
										</button>
										&nbsp; <button type="button" id="btnUpdate" class="btn-sm btn-primary"
											title="Update">
											<i class="fa fa-save"></i> Update
										</button>
										&nbsp; <button type="button" id="btnSearchPost" class="btn-sm btn-info"
											title="Search">
											<i class="fa fa-search"></i> Search
										</button>
										&nbsp; <button type="submit" id="btnSearchGet" class="btn-sm btn-warning"
											title="Search Get">
											<i class="fa fa-search"></i> Search Get
										</button>
										&nbsp; <button type="button" id="btnExport" class="btn-sm btn-success"
											title="Export">
											<i class="fa fa-download"></i> Export
										</button>
									</div>
								</form>
								<input name="listData" id="listData" type="hidden" value="<%= itemString %>">
								<input name="sysLanguage" id="sysLanguage" type="hidden" value="<%= language %>">
								<input name="listDataCatalogue" id="listDataCatalogue" type="hidden">
								<!-- // Underline -->
								<!--<div class="card card-info card-outline collapsed-card"></div>-->
							</div> <!-- End <div class="modal-body">  -->
							<!-- ================= Other information ==============================-->
							<div class="card card-info card-outline collapsed-card">
								<div class="card-header">
									<h6 class="card-title">Other information</h6>
									<div class="card-tools">
										<button type="button" class="btn btn-tool" data-card-widget="collapse"
											data-toggle="tooltip" title="Collapse">
											<i class="fas fa-plus"></i>
										</button>
									</div>
								</div>
								<div class="card-body" style="display: none;">
									<div class="row justify-content-between">
										<label class="col-sm-3 col-form-label text-sm-right"
											id="labuser_name_created_Text">User name created: </label>
										<label class="col-sm-3 col-form-label" id="labuser_name_created_Value">User name
											created: </label>
										<label class="col-sm-3 col-form-label text-sm-right"
											id="labdatetime_created_Text">Datetime created: </label>
										<label class="col-sm-3 col-form-label" id="labdatetime_created_Value">Datetime
											created:</label>
										<label class="col-sm-3 col-form-label text-sm-right"
											id="labuser_name_modified_Text">User name modifiedd: </label>
										<label class="col-sm-3 col-form-label" id="labuser_name_modified_Value">User
											name modifiedd: </label>
										<label class="col-sm-3 col-form-label text-sm-right"
											id="labdatetime_modified_Text">DateTime modified: </label>
										<label class="col-sm-3 col-form-label" id="labdatetime_modified_Value">DateTime
											modified: </label>
									</div>
								</div>

							</div>
							<!-- ================= End Other information ==================== -->
						</div> <!-- End <div class="modal-content">  -->
					</div>
				</div>
				<!-- ================ End Modal From ============================= -->

				<div class="card card-info card-outline">
					<div class="card-header">
						<h4 class="card-title">List data &nbsp;</h4>
						<!-- //===========================================-->
						<div class="button-group card-title">
							<button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
								<span class="fas fa-cog"></span>
								<span class="caret"></span>
							</button>
							<ul class="dropdown-menu" style="width: 300px;">
								<li>
									<a href="#" class="small" data-value="parent_id" tabIndex="-1">
										<input type="checkbox" id="ckhShowColumnparent_id" />&nbsp;
										<label id="labparent_id_CheckboxShow">Parent </label>
									</a> &nbsp; &nbsp;
								</li>
								<li>
									<a href="#" class="small" data-value="name" tabIndex="-1">
										<input type="checkbox" id="ckhShowColumnname" />&nbsp;
										<label id="labname_CheckboxShow">Name </label>
									</a> &nbsp; &nbsp;
									<a href="#" class="small" data-value="slug" tabIndex="-1">
										<input type="checkbox" id="ckhShowColumnslug" />&nbsp;
										<label id="labslug_CheckboxShow">Slug </label>
									</a>
								</li>
								<li>
									<a href="#" class="small" data-value="thumbnail" tabIndex="-1">
										<input type="checkbox" id="ckhShowColumnthumbnail" />&nbsp;
										<label id="labthumbnail_CheckboxShow">Image </label>
									</a> &nbsp; &nbsp;
									<a href="#" class="small" data-value="viewtype" tabIndex="-1">
										<input type="checkbox" id="ckhShowColumnviewtype" />&nbsp;
										<label id="labviewtype_CheckboxShow">View Type </label>
									</a>
								</li>
								<li>
									<a href="#" class="small" data-value="zone" tabIndex="-1">
										<input type="checkbox" id="ckhShowColumnzone" />&nbsp;
										<label id="labzone_CheckboxShow">Zone </label>
									</a> &nbsp; &nbsp;
									<a href="#" class="small" data-value="is_show_homepage" tabIndex="-1">
										<input type="checkbox" id="ckhShowColumnis_show_homepage" />&nbsp;
										<label id="labis_show_homepage_CheckboxShow">Show Homepage </label>
									</a>
								</li>
								<li>
									<a href="#" class="small" data-value="ordering" tabIndex="-1">
										<input type="checkbox" id="ckhShowColumnordering" />&nbsp;
										<label id="labordering_CheckboxShow">Ordering </label>
									</a> &nbsp; &nbsp;
									<a href="#" class="small" data-value="description" tabIndex="-1">
										<input type="checkbox" id="ckhShowColumndescription" />&nbsp;
										<label id="labdescription_CheckboxShow">Description </label>
									</a>
								</li>
								<li>
									<a href="#" class="small" data-value="status" tabIndex="-1">
										<input type="checkbox" id="ckhShowColumnstatus" />&nbsp;
										<label id="labstatus_CheckboxShow">Status </label>
									</a> &nbsp; &nbsp;
								</li>
							</ul>
						</div>
						<!-- //=========================================================== -->
						<div class="card-tools">
							<button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip"
								title="Collapse"><i class="fas fa-minus"></i></button>
						</div>
					</div>
					<div class="card-body">
						<table id="tablecategories" class="table table-bordered table-hover btn-table mb-0">
							<thead>
								<tr>
									<th class="text-center" style="min-width:120px ;">
										<div class="custom-control custom-checkbox">
											<input class="custom-control-input cbAll" type="checkbox" id="check-all">
											<label for="check-all" class="custom-control-label"></label>
										</div>
									</th>
									<th class="text-center" data-sort="" data-column="parent_id" class="columnHeader"
										onclick="sortByColumn(this)">
										<label id="labparent_id_tb">
											Parent <i class="fa fa-fw" data-column="parent_id"></i>
										</label>
									</th>
									<th class="text-center" data-sort="" data-column="name" class="columnHeader"
										onclick="sortByColumn(this)">
										<label id="labname_tb">
											Name <i class="fa fa-fw" data-column="name"></i>
										</label>
									</th>
									<th class="text-center" data-sort="" data-column="slug" class="columnHeader"
										onclick="sortByColumn(this)">
										<label id="labslug_tb">
											Slug <i class="fa fa-fw" data-column="slug"></i>
										</label>
									</th>
									<th class="text-center" data-sort="" data-column="thumbnail" class="columnHeader"
										onclick="sortByColumn(this)">
										<label id="labthumbnail_tb">
											Image <i class="fa fa-fw" data-column="thumbnail"></i>
										</label>
									</th>
									<th class="text-center" data-sort="" data-column="viewtype" class="columnHeader"
										onclick="sortByColumn(this)">
										<label id="labviewtype_tb">
											View Type <i class="fa fa-fw" data-column="viewtype"></i>
										</label>
									</th>
									<th class="text-center" data-sort="" data-column="zone" class="columnHeader"
										onclick="sortByColumn(this)">
										<label id="labzone_tb">
											Zone <i class="fa fa-fw" data-column="zone"></i>
										</label>
									</th>
									<th class="text-center" data-sort="" data-column="is_show_homepage"
										class="columnHeader" onclick="sortByColumn(this)">
										<label id="labis_show_homepage_tb">
											Show Homepage <i class="fa fa-fw" data-column="is_show_homepage"></i>
										</label>
									</th>
									<th class="text-center" data-sort="" data-column="ordering" class="columnHeader"
										onclick="sortByColumn(this)">
										<label id="labordering_tb">
											Ordering <i class="fa fa-fw" data-column="ordering"></i>
										</label>
									</th>
									<th class="text-center" data-sort="" data-column="description" class="columnHeader"
										onclick="sortByColumn(this)">
										<label id="labdescription_tb">
											Description <i class="fa fa-fw" data-column="description"></i>
										</label>
									</th>
									<th class="text-center" data-sort="" data-column="status" class="columnHeader"
										onclick="sortByColumn(this)">
										<label id="labstatus_tb">
											Status <i class="fa fa-fw" data-column="status"></i>
										</label>
									</th>
								</tr>
							</thead>
							<tbody id="bodyTablecategories">
								<tr>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
									<th class="text-center"></a></th>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="form-group row">
					<div class="col-xs-1 col-sm-1">Quantity per page:</div>
					<div class="col-xs-1 col-sm-1">
						<input type="number" class="form-control form-control-sm" name="numberItemPerPage"
							id="numberItemPerPage" size="4">
					</div>
					<div class="col-xs-9 col-sm-9" id="paginationcategories">
					</div>
				</div>
			</div>
			<script type="application/javascript">
				var language={};
				var listData;
				var linkPrefix=$('#linkPrefix').val();
				var idMainTable="tablecategories";
				setSelectedColumnToShowInterface(idMainTable);

				onLoadData();
				function onLoadData() {
					getLanguage();
					setUpdateButtonStatus(false)
					setInterfaceText();
					getNumberItemPerPage();
					var strData=$('#listData').val();
					listData=JSON.parse(strData);
					if(listData.length>0) {
						displayDataToTable();
						var paramsString=$('#params').val();
						const params=JSON.parse(paramsString);
						paginationHelper(params.pagination,"categories",params.currentStatus,params.keyword,linkPrefix,"paginationcategories");
					}
				}

				function displayDataToTable() {
					sortDataJson();
					showAllColumnInTable(idMainTable);
					link=createLinkImage("categories");
					var table=document.getElementById("bodyTablecategories");
					var lengthtable=table.rows.length-1;
					for(var n=lengthtable;n>=0;n--) {
						table.deleteRow(n);
					}
					var length=listData.length;
					if(length<1) {
						showNoticeDanger(language.Message_NotFoundData);
						return false;
					}
					$("#modaMainForm").modal('hide');
					listData.forEach(function(data) {
						var row=table.insertRow(0);
						var cell0=row.insertCell(0);
						var cell1=row.insertCell(1);
						var cell2=row.insertCell(2);
						var cell3=row.insertCell(3);
						var cell4=row.insertCell(4);
						var cell5=row.insertCell(5);
						var cell6=row.insertCell(6);
						var cell7=row.insertCell(7);
						var cell8=row.insertCell(8);
						var cell9=row.insertCell(9);
						var cell10=row.insertCell(10);
						//var cell11=row.insertCell(11);
						let check=`<div class="custom-control custom-checkbox"> 
						<input class="custom-control-input" type="checkbox" name="chkListData" id="${data._id}" value="${data._id}">
						<label for="${data._id}" class="custom-control-label"></label>
						`;
						let strbutton=" <a  onclick=\"getById('"+data._id+"')\" type=\"button\" class=\"rounded-circle btn btn-sm btn-info\" title=\"Edit\">"+
							"<i class=\"fas fa-pencil-alt\"></i>"+
							"</a> "+
							" <button type=\"button\" class=\"rounded-circle btn btn-sm btn-danger\" data-id=\""+data._id+"\" title=\"Delete\"  onclick=\"deleteById(this,'"+data._id+"','"+data.parent_id+"')\">";
						strbutton+=" <i class=\"fas fa-trash-alt\"></i> ";
						strbutton+=" </ button > </div>";


						cell0.innerHTML=check+strbutton;
						categoryParent=data.categoryParent;
						if(categoryParent!=undefined) {
							if(categoryParent.parentName!=undefined)
								cell1.innerHTML=categoryParent.parentName;
						}
						cell2.innerHTML=data.name;
						cell3.innerHTML=data.slug;
						//1. display value
						//cell4.innerHTML = data.thumbnail;
						//2. display image
						cell4.innerHTML=`<img src="${link}${data.thumbnail}" alt="" width="100" >`;
						//3. display full link
						//cell4.innerHTML = `${link}${data.thumbnail}`;
						//4. display download file
						//cell4.innerHTML=`<a href="${link}${data.thumbnail}" target="_blank">Download</a>`;
						cell5.innerHTML=data.viewtype;
						cell6.innerHTML=data.zone;
						cell7.innerHTML=data.is_show_homepage;
						cell8.innerHTML=data.ordering;
						cell9.innerHTML=data.description;
						cell10.innerHTML=data.status;

						//cell11.innerHTML=strbutton;
					});
					hideColumnInTable(idMainTable);
				}


				createDataForDropdownLists();
				function createDataForDropdownLists() {
					createDataForDropdown(listData,'parent_id','_id','parentName','name','-- Chose parent category --',{'showId': false});
				}
				closeAllDropdown();
				function closeAllDropdown() {
					var DivContenparentName=document.getElementById('DivContenparentName');
					DivContenparentName.hidden=true;
				}

				$('input#name').keyup(function() {
					$('input[name="slug"]').val(change_alias($(this).val()));
				});


				$("#viewtype").change(function() { 
					checkViewType()					
				}); 
				checkViewType();
				function checkViewType() {
					let view=$('#viewtype').val();				
					if(view == 'view-link'){						
						$('#divlink').css('display','');
						$('#lablink').css('display','');
						
					}
					else{
						$('#divlink').css('display','none');
						$('#lablink').css('display','none');
					}
				}
				

				function setUpdateButtonStatus(statusUpdate) {
					$('#btnSave').prop('hidden',statusUpdate);
					$('#btnUpdate').prop('hidden',!statusUpdate);
				}





				function getLanguage() {
					var languageString=$('#sysLanguage').val();
					language=JSON.parse(languageString);
				}

				function setInterfaceText() {
					$("#pageTitle").html(language.TitlePage);
					$("#labparent_id").text(language.parent_id);
					$("#labname").text(language.name);
					$("#labslug").text(language.slug);
					$("#labthumbnail").text(language.thumbnail);
					$("#labviewtype").text(language.viewtype);
					$("#lablink").text(language.link);
					$("#labzone").text(language.zone);
					$("#labis_show_homepage").text(language.is_show_homepage);
					$("#labordering").text(language.ordering);
					$("#labdescription").text(language.description);
					$("#labstatus").text(language.status);

					$("#labparent_id_tb").html(language.parent_id+"<i class=\"fa fa-fw\" data-column=\"parent_id\"></i>");
					$("#labname_tb").html(language.name+"<i class=\"fa fa-fw\" data-column=\"name\"></i>");
					$("#labslug_tb").html(language.slug+"<i class=\"fa fa-fw\" data-column=\"slug\"></i>");
					$("#labthumbnail_tb").html(language.thumbnail+"<i class=\"fa fa-fw\" data-column=\"thumbnail\"></i>");
					$("#labviewtype_tb").html(language.viewtype+"<i class=\"fa fa-fw\" data-column=\"viewtype\"></i>");
					$("#labzone_tb").html(language.zone+"<i class=\"fa fa-fw\" data-column=\"zone\"></i>");
					$("#labis_show_homepage_tb").html(language.is_show_homepage+"<i class=\"fa fa-fw\" data-column=\"is_show_homepage\"></i>");
					$("#labordering_tb").html(language.ordering+"<i class=\"fa fa-fw\" data-column=\"ordering\"></i>");
					$("#labdescription_tb").html(language.description+"<i class=\"fa fa-fw\" data-column=\"description\"></i>");
					$("#labstatus_tb").html(language.status+"<i class=\"fa fa-fw\" data-column=\"status\"></i>");

					$("#labparent_id_CheckboxShow").text(language.parent_id);
					$("#labname_CheckboxShow").text(language.name);
					$("#labslug_CheckboxShow").text(language.slug);
					$("#labthumbnail_CheckboxShow").text(language.thumbnail);
					$("#labviewtype_CheckboxShow").text(language.viewtype);
					$("#labzone_CheckboxShow").text(language.zone);
					$("#labis_show_homepage_CheckboxShow").text(language.is_show_homepage);
					$("#labordering_CheckboxShow").text(language.ordering);
					$("#labdescription_CheckboxShow").text(language.description);
					$("#labstatus_CheckboxShow").text(language.status);
				}

				function getById(Id) {
					var link=linkPrefix+'getById/'+Id;
					$.ajax({
						type: 'GET',
						url: link,
						dataType: "json",
						success: function(resultdata) {
							var success=resultdata.success;
							if(success==true) {
								showDataToForm(resultdata.data);
							}
						},
						failure: function(response) {
							alert(language.Message_GetItemByIdError);
						},
						error: function(response) {
							alert(language.Message_GetItemByIdError);
						},
					});
				}

				function showDataToForm(data) {
					try {
						setUpdateButtonStatus(true);
						$("#modaMainForm").modal('show');
						$('#_idHidden').val(data._id);
						categoryParent=data.categoryParent;
						if(categoryParent!=undefined) {
							if(categoryParent.parentName!=undefined) {
								$('#parent_id').val(categoryParent.parent_id);
								$('#parentName').val(categoryParent.parentName);
							}
						}
						$('#name').val(data.name);
						$('#slug').val(data.slug);
						$('#thumbnail_old').val(data.thumbnail);
						$('#viewtype').val(data.viewtype);
						$('#link').val(data.link);
						$('#zone').val(data.zone);
						if((data.is_show_homepage=="true")||(data.is_show_homepage==true)||(data.is_show_homepage=="active")||(data.is_show_homepage=="yes")||(data.is_show_homepage=="1"))
							$("#is_show_homepage").prop("checked",true);
						else $("#is_show_homepage").prop("checked",false);
						$('#ordering').val(data.ordering);
						$('#description').val(data.description);
						$('#status').val(data.status);

						create=data.create;
						if(create!=undefined) {
							$('#labuser_name_created_Value').text(create.user_name_created);
							$('#labdatetime_created_Value').text(create.datetime_created);
						}
						modified=data.modified;
						if(modified!=undefined) {
							$('#labuser_name_modified_Value').text(modified.user_name_modified);
							$('#labdatetime_modified_Value').text(modified.datetime_modified);
						}
					}
					catch(error) {}
				}

				$('#btnOpenMainModalForm').click(function() {
					$("#modaMainForm").modal('show');
					clearForm();
				});

				$('#btnSearchPost_OpenForm').click(function() {
					$("#modaMainForm").modal('show');
				});

				$('#btnExport_OpenForm').click(function() {
					$("#modaMainForm").modal('show');
				});

				function clearForm() {
					try {
						$('#_idHidden').val('');
						setUpdateButtonStatus(false)
						$('#parent_id').val('');
						$('#name').val('');
						$('#slug').val('');
						$('#thumbnail').val('');
						$('#viewtype').val('');
						$('#link').val('');
						$('#zone').val('');
						$("#is_show_homepage").prop("checked",false);
						$('#ordering').val('');
						$('#description').val('');
						$('#status').val('');
					}
					catch(error) {}
				}

				$('#btnSearchPost').click(function() {
					$(this).prop('disabled',true);
					getContentPages(1);
				});

				function getContentPages(page) {
					var sortStorage=getSortType(linkPrefix);
					let data={
						parent_id: $('#parent_id').val(),
						name: $('#name').val(),
						slug: $('#slug').val(),
						thumbnail: $('#thumbnail').val(),
						viewtype: $('#viewtype').val(),
						zone: $('#zone').val(),
						description: $('#description').val(),
						status: $('#status').val(),
						Page: page,
						sortColumn: sortStorage.sortColumn,
						sortType: sortStorage.sortType,
						numberItemPerPage: $('#numberItemPerPage').val()
					}
					var link=linkPrefix+'search';
					$.ajax({
						type: 'POST',
						url: link,
						data: data,
						dataType: "json",
						success: function(resultdata) {
							$('#btnSearchPost').prop('disabled',false);
							listData=resultdata.data;
							displayDataToTable();
							let params=resultdata.params;
							paginationHelper(params.pagination,"categories","","",linkPrefix,"paginationcategories");

							if(params.pagination.totalItems>0) {
								var message=language.Message_Find+params.pagination.totalItems+language.Message_Words_records;
								showNoticeSuccess(message);
							}
						},
						failure: function(response) {
							$('#btnSearchPost').prop('disabled',false);
							showNoticeDanger('Search Error');
						},
						error: function(response) {
							$('#btnSearchPost').prop('disabled',false);
							showNoticeDanger('Search Error');
						}
					});
					$('#btnSearchPost').prop('disabled',false);
				}

				$('#btnSave').click(function() {
					$(this).prop('disabled',true);
					chekValueAndSubmit();
					$(this).prop('disabled',false);
				});

				function chekValueAndSubmit() {
					if(($('#name').val().length<1)||($('#name').val().length>50)) {
						var message=formatMessage(language.name+": "+language.Message_Invalid_name,'1','50');
						alert(message);
						return false;
					}
					if(($('#slug').val().length<1)||($('#slug').val().length>50)) {
						var message=formatMessage(language.slug+": "+language.Message_Invalid_slug,'1','50');
						alert(message);
						return false;
					}
					if(($('#viewtype').val().length<3)||($('#viewtype').val().length>20)) {
						var message=formatMessage(language.viewtype+": "+language.Message_Invalid_viewtype,'3','20');
						alert(message);
						return false;
					}
					else if($('#viewtype').val()=='view-link'){
						if(($('#link').val().length<5)||($('#link').val().length>300)) {
							var message=formatMessage(language.link+": "+language.Message_Invalid_link,'5','300');
							alert(message);
							return false;
						}
					}
					let is_show_homepage=$('#is_show_homepage').is(":checked")? 1:0;
					$('#is_show_homepage').val(is_show_homepage);
					if(($('#status').val().length<3)||($('#status').val().length>10)) {
						var message=formatMessage(language.status+": "+language.Message_Invalid_status,'3','10');
						alert(message);
						return false;
					}
					document.getElementById("formcategories").submit();
				}

				function getDataForm() {
					if(($('#name').val().length<1)||($('#name').val().length>50)) {
						var message=formatMessage(language.name+": "+language.Message_Invalid_name,'1','50');
						alert(message);
						return false;
					}
					if(($('#slug').val().length<1)||($('#slug').val().length>50)) {
						var message=formatMessage(language.slug+": "+language.Message_Invalid_slug,'1','50');
						alert(message);
						return false;
					}
					if(($('#viewtype').val().length<3)||($('#viewtype').val().length>20)) {
						var message=formatMessage(language.viewtype+": "+language.Message_Invalid_viewtype,'3','20');
						alert(message);
						return false;
					}
					else if($('#viewtype').val()=='view-link'){
						if(($('#link').val().length<5)||($('#link').val().length>300)) {
							var message=formatMessage(language.link+": "+language.Message_Invalid_link,'5','300');
							alert(message);
							return false;
						}
					}
					if(($('#status').val().length<3)||($('#status').val().length>10)) {
						var message=formatMessage(language.status+": "+language.Message_Invalid_status,'3','10');
						alert(message);
						return false;
					}
					return {
						'_idHidden': $('#_idHidden').val(),
						'parent_id': $('#parent_id').val(),
						'categoryParent': {
							'id': $('#parent_id').val(),
							'parentName': $('#parentName').val()
						},
						'name': $('#name').val(),
						'slug': $('#slug').val(),
						'thumbnail': $('#thumbnail').val(),
						'viewtype': $('#viewtype').val(),
						'link': $('#link').val(),
						'zone': $('#zone').val(),
						'is_show_homepage': $('#is_show_homepage').is(":checked")? 1:0,
						'ordering': $('#ordering').val(),
						'description': $('#description').val(),
						'status': $('#status').val(),
						'link': $('#link').val(),
					}
				}

				function saveInsert() {
					let data=getDataForm();
					if(data==false) {
						$('#btnSave').prop('disabled',false);
						return false;
					}
					var link=linkPrefix+'save';
					$.ajax({
						type: 'post',
						url: link,
						data: data,
						dataType: "json",
						success: function(response) {
							var success=response.success;
							var result=response.data;
							if((success=='false')||(success==false))
								showNoticeDanger(language.Message_AddNewError+' ('+response.message+')');
							else if((success!=true)&&(success!='true'))
								showNoticeDanger(result.message);
							else {
								insertRow(result.data);
								clearForm();
							}
						},
						failure: function(response) {
							showErrorMessageSave(response,language.Message_AddNewError);
						},
						error: function(response) {
							showErrorMessageSave(response,language.Message_AddNewError);
						},
					});
					$('#btnSave').prop('disabled',false);
				}

				function insertRow(data) {
					showAllColumnInTable(idMainTable);
					showNoticeSuccess(language.Message_AddNewSuccess);
					var table=document.getElementById("bodyTablecategories");
					var row=table.insertRow(0);
					var cell0=row.insertCell(0);
					var cell1=row.insertCell(1);
					var cell2=row.insertCell(2);
					var cell3=row.insertCell(3);
					var cell4=row.insertCell(4);
					var cell5=row.insertCell(5);
					var cell6=row.insertCell(6);
					var cell7=row.insertCell(7);
					var cell8=row.insertCell(8);
					var cell9=row.insertCell(9);
					var cell10=row.insertCell(10);
					var cell11=row.insertCell(11);
					let check=`<div class="custom-control custom-checkbox"> 
					<input class="custom-control-input" type="checkbox" name="chkListData" id="${data._id}" value="${data._id}">
					<label for="${data._id}" class="custom-control-label"></label>
				</div>`;
					let strbutton=" <a  onclick=\"getById('"+data._id+"')\" type=\"button\" class=\"rounded-circle btn btn-sm btn-info\" title=\"Edit\">"+
						"<i class=\"fas fa-pencil-alt\"></i>"+
						"</a> "+
						" <button type=\"button\" class=\"rounded-circle btn btn-sm btn-danger\" data-id=\""+data._id+"\" title=\"Delete\"  onclick=\"deleteById(this,'"+data._id+"','"+data.parent_id+"')\">";
					strbutton+=" <i class=\"fas fa-trash-alt\"></i> ";
					strbutton+=" </ button > ";
					cell0.innerHTML=check+strbutton;
					cell1.innerHTML=data.parent_id;
					cell2.innerHTML=data.name;
					cell3.innerHTML=data.slug;
					cell4.innerHTML=data.thumbnail;
					cell5.innerHTML=data.viewtype;
					cell6.innerHTML=data.zone;
					cell7.innerHTML=data.is_show_homepage;
					cell8.innerHTML=data.ordering;
					cell9.innerHTML=data.description;
					cell10.innerHTML=data.status;

					//cell11.innerHTML=strbutton;
					hideColumnInTable(idMainTable);
				}

				$('#btnUpdate').click(function() {
					$(this).prop('disabled',true);
					chekValueAndSubmit();
					$(this).prop('disabled',false);
				});

				function saveUpdate() {
					let data=getDataForm();
					if(data==false) {
						$('#btnUpdate').prop('disabled',false);
						return false;
					}
					if(data._idHidden=="") {
						$('#btnUpdate').prop('disabled',false);
						showNoticeDanger(language.Message_HaveNotSelectedItemUpdate);
						return false;
					}
					var link=linkPrefix+'update';
					$.ajax({
						type: 'put',
						url: link,
						data: data,
						dataType: "json",
						success: function(response) {
							var success=response.success;
							var result=response.data;
							if((success=='false')||(success==false)) {
								showNoticeDanger(language.Message_UpdateError);
								return false;
							}
							else if((success!=true)&&(success!='true')) {
								showNoticeDanger(result.message);
								return false;
							}
							else {
								updateRow(result.data);
								clearForm();
							}
						},
						failure: function(response) {
							showErrorMessageSave(response,language.Message_UpdateError);
						},
						error: function(response) {
							showErrorMessageSave(response,language.Message_UpdateError);
						}
					});
					$('#btnUpdate').prop('disabled',false);
				}

				function updateRow(data) {
					showNoticeSuccess(language.Message_UpdateSuccess);
					showAllColumnInTable(idMainTable);
					$("#modaMainForm").modal('hide');
					var row=$("#tablecategories button[data-id='"+data._id+"']").parents("tr")[0];
					var tr="<tr>"+
						"<td class=\"text-center\">"+
						"<div class=\"custom-control custom-checkbox\">"+
						"<input class=\"custom-control-input\" type=\"checkbox\" name=\"chkListData\" id=\""+data._id+"\" value=\""+data._id+"\"> "+
						"<label for=\""+data._id+"\" class=\"custom-control-label\"></label> "+
						"</div>"+
						" <a  onclick=\"getById('"+data._id+"')\" type=\"button\" class=\"rounded-circle btn btn-sm btn-info\" title=\"Edit\">"+
						" <i class=\"fas fa-pencil-alt\"></i>"+
						" </a>"+
						" <button type=\"button\" class=\"rounded-circle btn btn-sm btn-danger\" data-id=\""+data._id+"\" title=\"Delete\"  onclick=\"deleteById(this,'"+data._id+"','"+data.parent_id+"')\">"+
						" <i class=\"fas fa-trash-alt\"></i> "+
						" </button> "+
						"</td>";
					tr+="<td class=\"text-center\">"+data.parent_id+"</td>";
					tr+="<td class=\"text-center\">"+data.name+"</td>";
					tr+="<td class=\"text-center\">"+data.slug+"</td>";
					tr+="<td class=\"text-center\">"+data.thumbnail+"</td>";
					tr+="<td class=\"text-center\">"+data.viewtype+"</td>";
					tr+="<td class=\"text-center\">"+data.zone+"</td>";
					tr+="<td class=\"text-center\">"+data.is_show_homepage+"</td>";
					tr+="<td class=\"text-center\">"+data.ordering+"</td>";
					tr+="<td class=\"text-center\">"+data.description+"</td>";
					tr+="<td class=\"text-center\">"+data.status+"</td>";
					// tr+="<td class=\"text-center\">"+

					// 	" </td>"+
					// 	" </tr>";
					$(row).after(tr);
					$(row).remove();
					hideColumnInTable(idMainTable);
				}
				function deleteById(row,objectId,objectName) {
					var message=language.Message_DoYouWantToDeleteById+' '+objectName+'?';
					var answer=confirm(message)
					if(!answer) {return false;}
					let data={
						'_id': objectId
					};
					var link=linkPrefix+'deleteById';
					$.ajax({
						type: 'delete',
						url: link,
						data: data,
						dataType: "json",
						success: function(resultdata) {
							var success=resultdata.success;
							var message=resultdata.message;
							var notice={};
							if((success=='true')||(success==true)) {
								showNoticeSuccess(language.Message_DeleteSuccess);
								var i=row.parentNode.parentNode.rowIndex;
								document.getElementById("tablecategories").deleteRow(i);
								return true;
							}
							else if((success=='false')||(success==false)) {
								showNoticeDanger(language.Message_DeleteFail);
								return false;
							}
							else if(message.length>10) {
								showNoticeDanger(message);
								return false;
							}
							else {
								showNoticeDanger(language.Message_DeleteFail);
								return false;
							}
						},
						failure: function(response) {
							showNoticeDanger(language.Message_DeleteFail);
						},
						error: function(response) {
							showNoticeDanger(language.Message_DeleteFail);
						}
					});
				}

				$('#btnDelete').click(function() {
					$(this).prop('disabled',true);
					deleteList();
					$(this).prop('disabled',false);
				});
				function deleteList() {
					var arrayId=[];
					var listId=" ";
					$("input:checkbox[name=chkListData]:checked").each(function() {
						arrayId.push($(this).val());
						listId+=$(this).val()+',';
					});
					let message=language.Message_DoYouWantToDeleteInTheList+'?';
					var answer=confirm(message)
					if(!answer) {return false;}
					let data={arrayId};
					var link=linkPrefix+'deleteList';
					$.ajax({
						type: 'delete',
						url: link,
						data: data,
						dataType: "json",
						success: function(resultdata) {
							var result=resultdata.data;
							var success=result.success;
							var message=result.message;
							if((success=='true')||(success==true)) {
								let deleteSuccess=result.deleteSuccess;
								let deleteError=result.deleteError;
								if(deleteSuccess.length>0) {
									let message=language.Message_DeleteSuccess;
									message+=" "+deleteSuccess.toString();
									if(deleteError.length>0) {
										message+=" \n"+language.Message_DeleteFail+" "+deleteError.toString();
									}
									showNoticeSuccess(message);
									deleteRows(arrayId,"bodyTablecategories");
									return true;
								}
								else if(deleteError.length>0) {
									let message=language.Message_DeleteFail+" "+deleteError.toString();
									showNoticeDanger(message);
								}
								else {
									showNoticeDanger(language.Message_DeleteFail);
								}
							}
							else if((success=='false')||(success==false)) {
								showNoticeDanger(language.Message_DeleteFail);
								return false;
							}
						},
						failure: function(response) {
							showNoticeDanger(language.Message_DeleteFail);
						},
						error: function(response) {
							showNoticeDanger(language.Message_DeleteFail);
						}
					});
				}

				$('#btnExport').click(function() {
					$(this).prop('disabled',true);
					exportData();
					$(this).prop('disabled',false);
				});

				function exportData() {
					let data={
						'parent_id': $('#parent_id').val(),
						'name': $('#name').val(),
						'slug': $('#slug').val(),
						'thumbnail': $('#thumbnail').val(),
						'viewtype': $('#viewtype').val(),
						'zone': $('#zone').val(),
						'description': $('#description').val(),
						'status': $('#status').val(),
					}
					var link=linkPrefix+'exportData';
					$.ajax({
						type: 'post',
						url: link,
						data: data,
						dataType: "json",
						success: function(resultdata) {
							$('#btnExport').prop('disabled',false);
							let result=resultdata.data;
							showNoticeSuccess(language.Message_CompletedGetData);
							ExportToExcel(result);
						},
						failure: function(response) {
							$('#btnExport').prop('disabled',false);
							showNoticeDanger('Export Error');
						},
						error: function(response) {
							$('#btnExport').prop('disabled',false);
							showNoticeDanger('Export Error');
						}
					});
					$('#btnExport').prop('disabled',false);
				}

				function ExportToExcel(datas) {
					let itemCount=datas.length;
					if(itemCount>1000) {
						showNoticeDanger(language.Message_WarningWhenExportingDataTooMuch);
					}
					if(itemCount<1) {
						showNoticeDanger(language.Message_NotFoundData);
					}
					var strTable='<style type="text/css">';
					strTable+=' .Border { ';
					strTable+='         color: windowtext; ';
					strTable+='         font-size: 11.0pt; ';
					strTable+='         word-break:break-all;';
					strTable+='         font-style: normal; ';
					strTable+='         text-decoration: none; ';
					strTable+='         font-family: "Times New Roman", serif; ';
					strTable+='         text-align: left; ';
					strTable+='         vertical-align: bottom;';
					strTable+='         border-left: .5pt solid windowtext; ';
					strTable+='         border-right: .5pt solid windowtext; ';
					strTable+='         border-top: .5pt solid windowtext; ';
					strTable+='         border-bottom: .5pt solid windowtext; ';
					strTable+='         padding-left: 1px; ';
					strTable+='         padding-right: 1px; ';
					strTable+='         padding-top: 1px; ';
					strTable+='     } ';

					strTable+=' .BorderHeader { ';
					strTable+='        color: white; ';
					strTable+='         background-color:#0026ff; ';
					strTable+='        font-size: 11.0pt; ';
					strTable+='        text-align: center; ';
					strTable+='        font-style: normal; ';
					strTable+='        text-decoration: none; ';
					strTable+='        font-family: "Times New Roman", serif; ';
					strTable+='        vertical-align: bottom;';
					strTable+='        border-left: .5pt solid windowtext; ';
					strTable+='        border-right: .5pt solid windowtext; ';
					strTable+='        border-top: .5pt solid windowtext; ';
					strTable+='        border-bottom: .5pt solid windowtext; ';
					strTable+='        padding-left: 1px; ';
					strTable+='        padding-right: 1px; ';
					strTable+='        padding-top: 1px; ';
					strTable+='     } ';
					strTable+='  </style> ';
					strTable+=' <table id="testTable"  border="1" frame="hsides" rules="groups" summary="Code page support in different versions of MS Windows."> ';
					strTable+='<tr class="BorderHeader" style="background - color:#0026ff; color:#fff"> ';
					strTable+='<th class="BorderHeader" >Order</th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Parent </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Name </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Slug </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Image </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> View Type </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Link </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Zone </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Show Homepage </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Ordering </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Description </th> ';
					strTable+='<th  class="BorderHeader" style="width: 100px; white - space:nowrap"> Status </th> ';
					strTable+='</tr> ';
					var n=0;
					var currentRow=4;
					for(var i=0;i<itemCount;i++) {
						var vTemp=datas[i];
						currentRow+=1;
						n+=1;
						strTable+='<tr >';
						strTable+='<th class="Border" > '+n+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.parent_id+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.name+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.slug+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.thumbnail+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.viewtype+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.link+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.zone+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.is_show_homepage+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.ordering+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.description+' </th> ';
						strTable+='<th  class="Border" > '+vTemp.status+' </th> ';
						strTable+='</tr>';
					}
					strTable+=' </table> ';
					ExportHtmlToExcel(strTable,'categories');
					showNoticeSuccess(language.Message_ExportSuccess);
				}

			</script>